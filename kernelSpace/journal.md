**Ядро операционной системы**

kernel\_init производит базовую инициализацию стека, обработчика прерываний, драйверов

TODO:
- Добавить парсер dtb

Добавлена возможность в ядре переключать SBI, драйвер, находящаяся в include/kernelSpace/config.h на дебаг(debug) #define \_\_DBCN\_\_ (#undef \_\_DBCN\_\_), легаси(legacy) #define \_\_CN\_\_ (#undef \_\_CN\_\_) и UART(default) #define \_\_UART\_USE0\_\_ (#undef \_\_UART\_USE0\_\_)  в функции console\_printf


**Функции SBI (libsbi/)**
Cледующие описанные функции - интерфйес взаимодействия с SBI. Функции *sbi_debug_console_write* - записать в консоль строку указанного размера, *sbi_debug_console_read* - прочитать из консоли указанное кол-во символов, *sbi_debug_console_write_byte* - записать в консоль символ. Также есть устаревшие функции *sbi_console_putchar* - вывести символ в консоль, *sbi_console_getchar* - считать символ с клавиатуры. 

**Работа с отладкой (debug/)**
Для вывода в консоль используется функция console\_printf()

TODO:
- Реализовать ввод


**Исключение (arch/riscV/panic.S, .../htrap.c, .../trap.S)**
Добавлен макрос PANIC для отслеживания в какой строчке и файле упала программа
Загружен обработчик исключений в регистр stveс, сообщая какой тип исключения произошел

TODO:


**Виртуальная память (arch/riscV/memory/alloc.c,  .../mmu.c)**
В alloc.c происходит выделение физической памяти из пула \_free\_ram\_start под размер страницы 4096 байт
В mmu.c создается таблица виртуальных адресов согласно правилам Sv39 (таблица которая хранит физический адрес, а ключ это виртуальный адрес. Уровень таблицы зависит от SvX. В данном случае таблица состоит из трех уровней), чтобы в дальнейшем передать таблицу в регистр satp, для активации виртуальной памяти. В таблицу записываются все сегменты (которые находятся в линкере main.lds) программы

TODO:
- Будет ли оправдано хранение мета данных в buffFreeRam?


**Процесс (process/process_control.c .../switch_context.S)**
Создание и планирования процесса (планировщик) реализован в process\_contorl.c
Переключение контекса процесса происходит в switch\_context.S
Сохранение текущего процесса в стек, а в дальнейшем в массив процессов происходит в arch/riscV/trap.S, .../htrap.c

TODO:
- Улучшить планировщик (scheldure) (process\_control.c)
- Реализовать чтение ELF file (приоритет!)


**Системный вызов (arch/riscV/systemCalls/syscall.c)**
Происходит системный вызов с помощью асемблерной инструкции ecall в режиме пользователя
Системные вызовы используют стандарт LINUX(https://syscalls.mebeim.net/?table=riscv/64/rv64/latest)

| Номер          | Системный вызов | Описание |
| -------------- | --------------- | -------- |
| clone          | 220 (0xdc)      | Создает новый процесс | **-**
| exit           | 93 (0x5d)       | Завершает текущий процесс | **+-**
| waitpid        | 95 (0x5f)       | Переводит процесс в режим ожидания до тех пор, пока не завершатся его дочерние процессы (Ждет, пока процесс или поток завершит свою работу) | **-**
| execve         | 221 (0xdd)      | Выполняет новую программу в процессе | **-**
| getpid         | 172 (0xac)      | Получает уникальный идентификатор процесса | **-**
| openat         | 56 (0x38)       | Открыть файл или создать (или устройства) | **-**
| close          | 57 (0x39)       | Закрыть файл (или устройства) | **-**
| read           | 63 (0x3f)       | Выполняет чтение из файла (или устройства) | **-**
| write          | 64 (0x40)       | Выполняет запись в файл (или устройство) | **-**
| lseek          | 62 (0x3e)       | Меняет точку входа чтения/записи в файле | **-**
| unlinkat       | 35 (0x23)       | Удаляет файл или ссылку на файл          | **-**
| renameat2      | 276 (0x114)     | Меняет имя или местоположения файла | **-**
| mkdirat        | 34 (0x22)       | Создает каталог | **-**
|   ?            |    ?            | Удалить каталог | **-**
| chdir          | 49 (0x31)       | Изменяет текущий каталог | **-**
| statfs         | 43 (0x2b)       | Получить статус файла | **-**
| fstatfs        | 44 (0x2c)       | Получить статус открытого файла | **-**
| linkat         | 37 (0x25)       | Создать ссылку на файл | **-**
| symlinkat      | 36 (0x24)       | Получить статус открытого файла | **-**
| brk            | 214 (0xd6)      | Измненение размера сегмента данных | **-**
| mmap           | 222 (0xde)      | Создает новое отображение в виртуальном адресном пространстве процесса вызова | **-**
| clock\_gettime | 113 (0x71)      | Получить текущее время | **-**
| alarm          | ?               | Получить статус открытого файла | **-**
| getuid         | 174 (0xae)      | Получить айди пользовательского процесса | **-**
| getgid         | 176 (0xb0)      | Получить айди группы вызывающего процесса | **-**
| socket         | 198 (0xc6)      | Создать новый сокет | **-**
| bind           | 200 (0xc8)      | Привязать сокет к сетевому адресу | **-**
| listen         | 201 (0xc9)      | Помечается как сокет, который будет использоваться для приема входящих запросов на соединение с помощью accept | **-**
| accept         | 202 (0xca)      | Принимает соединение на сокете | **-**
| connect        | 203 (0xcb)      | Соединение сокета | **-**
| sendto         | 206 (0xce)      | Отправляет сообщение на сокет | **-**
| recvfrom       | 207 (0xcf)      | Получить сообщение от сокета | **-**
| umask          | 166 (0xa6)      | Изменяет права доступа/режима файла | **-**
| fchown         | 55 (0x37)       | Изменяет владельца файла | **-**

TODO:
- Реализовать базовые системные вызовы согласно стандарту LINUX(https://syscalls.mebeim.net/?table=riscv/64/rv64/latest), согласно таблице выше


**Драйвера (drivers/)**

(drivers/uart.c)
Реализован драйвер UART, с его помощью можно читать/записывать(uartRead/uartWrite) в коносоль данные

TODO:
- Уход от SBI
- Реализовать таймер
